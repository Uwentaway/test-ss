# Custom Shadowsocket Proxy Service

一个从零开发的自定义代理服务，采用独特的协议设计和AES-128-GCM加密机制，与开源shadowsocks实现完全不同。

## 🚀 特性

- **自定义协议**: 独特的数据包格式和握手机制
- **AES-128-GCM加密**: 标准化的认证加密算法，提供机密性和完整性保护
- **PBKDF2密钥派生**: 安全的密钥派生函数，防止彩虹表攻击
- **防重放攻击**: 时间戳验证机制
- **认证加密**: GCM模式内置认证，无需额外MAC验证
- **连接管理**: 智能连接池和超时处理
- **统计监控**: 实时连接和流量统计
- **错误恢复**: 健壮的错误处理机制

## 📁 项目结构

```
src/
├── server.js      # 代理服务端
├── client.js      # 代理客户端
├── crypto.js      # AES-128-GCM加密模块
├── protocol.js    # 协议实现
├── config.js      # 配置文件
└── utils.js       # 工具函数

test/
└── test.js        # 测试套件
```

## 🔧 安装和使用

### 1. 安装依赖
```bash
npm install
```

### 2. 启动服务端
```bash
npm run server
```
服务端将在 `127.0.0.1:8388` 启动

### 3. 启动客户端
```bash
npm run client
```
客户端将在 `127.0.0.1:1088` 启动本地代理

### 4. 配置浏览器
将浏览器HTTP代理设置为 `127.0.0.1:1088`

### 5. 运行测试
```bash
npm test
```

## 🛡️ 协议设计

### 协议头格式 (24字节)
```
Version(1) + Command(1) + UserID(4) + Timestamp(8) + HostLength(2) + Port(2) + Reserved(6)
```

### 数据包格式
```
[Length(4)] + [IV(12)] + [AuthTag(16)] + [EncryptedData(N)]
```

### 加密机制
- **密钥派生**: PBKDF2-SHA256 (10000轮迭代)
- **加密算法**: AES-128-GCM
- **认证**: GCM内置认证标签 (128位)
- **防重放**: 时间戳窗口验证 (5分钟)
- **随机IV**: 每个数据包使用唯一96位初始化向量

## 🔐 安全特性

1. **AES-128-GCM**: 标准化的认证加密算法
2. **PBKDF2密钥派生**: 10000轮迭代，防止暴力破解
3. **认证加密**: GCM模式提供机密性和完整性保护
4. **时间戳验证**: 5分钟窗口防止重放攻击
5. **随机IV**: 每个数据包使用唯一初始化向量
6. **密钥安全**: 安全的密钥派生和管理

## ⚙️ 配置选项

编辑 `src/config.js` 以自定义配置：

```javascript
const config = {
  server: {
    host: '0.0.0.0',        // 服务端监听地址
    port: 8388,             // 服务端端口
    password: 'your-key',   // 代理密码
    timeout: 30000          // 连接超时(ms)
  },
  client: {
    localHost: '127.0.0.1', // 本地监听地址
    localPort: 1088,        // 本地端口
    serverHost: 'server-ip', // 服务端地址
    serverPort: 8388,       // 服务端端口
    password: 'your-key'    // 代理密码
  },
  encryption: {
    method: 'aes-128-gcm',  // 加密方法
    keySize: 16,            // 密钥长度 (128位)
    ivSize: 12,             // IV长度 (96位)
    tagSize: 16             // 认证标签长度 (128位)
  }
};
```

## 📊 性能特点

- **低延迟**: 优化的数据包处理流程
- **高并发**: 异步I/O和连接池管理
- **内存高效**: 流式数据处理，避免大缓冲区
- **错误恢复**: 自动重连和故障转移
- **标准加密**: 使用经过验证的AES-GCM算法

## 🔍 监控和日志

服务自动记录：
- 连接统计信息
- 数据传输量
- 加密/解密操作
- 错误和异常
- 性能指标

## 🧪 测试功能

测试套件包含：
- AES-128-GCM加密/解密测试
- 密钥派生功能测试
- 协议解析测试
- 认证失败检测
- TCP连接测试

## 🚨 注意事项

1. **生产就绪**: 使用标准AES-128-GCM加密，适合生产环境
2. **密钥安全**: 使用强密码并定期更换
3. **网络环境**: 确保防火墙允许相应端口通信
4. **性能优化**: GCM模式提供硬件加速支持

## 🔄 升级说明

相比之前的XOR加密实现，新版本提供：
- 更强的安全性 (AES-128-GCM vs 自定义XOR)
- 标准化实现 (符合密码学最佳实践)
- 硬件加速支持 (现代CPU的AES-NI指令集)
- 简化的代码结构 (GCM内置认证)

## 🤝 贡献

欢迎提交Issue和Pull Request来改进项目！

## 📄 许可证

MIT License - 详见 LICENSE 文件