# Custom Shadowsocket Proxy Service

一个从零开发的自定义代理服务，采用独特的协议设计和加密机制，与开源shadowsocks实现完全不同。

## 🚀 特性

- **自定义协议**: 独特的数据包格式和握手机制
- **增强加密**: 基于XOR的多轮加密算法，带MAC验证
- **防重放攻击**: 时间戳验证机制
- **完整性保护**: HMAC数据完整性校验
- **连接管理**: 智能连接池和超时处理
- **统计监控**: 实时连接和流量统计
- **错误恢复**: 健壮的错误处理机制

## 📁 项目结构

```
src/
├── server.js      # 代理服务端
├── client.js      # 代理客户端
├── crypto.js      # 自定义加密模块
├── protocol.js    # 协议实现
├── config.js      # 配置文件
└── utils.js       # 工具函数

test/
└── test.js        # 测试套件
```

## 🔧 安装和使用

### 1. 安装依赖
```bash
npm install
```

### 2. 启动服务端
```bash
npm run server
```
服务端将在 `127.0.0.1:8388` 启动

### 3. 启动客户端
```bash
npm run client
```
客户端将在 `127.0.0.1:1088` 启动本地代理

### 4. 配置浏览器
将浏览器HTTP代理设置为 `127.0.0.1:1088`

### 5. 运行测试
```bash
npm test
```

## 🛡️ 协议设计

### 协议头格式 (24字节)
```
Version(1) + Command(1) + UserID(4) + Timestamp(8) + HostLength(2) + Port(2) + Reserved(6)
```

### 数据包格式
```
[Length(4)] + [IV(16)] + [MAC(8)] + [EncryptedData(N)]
```

### 加密机制
- **密钥派生**: SHA256(password + salt)
- **加密算法**: 增强XOR + 链式加密
- **完整性**: HMAC-SHA256 MAC验证
- **防重放**: 时间戳窗口验证

## 🔐 安全特性

1. **多层加密**: 基于位置和前向依赖的XOR变换
2. **完整性验证**: HMAC-SHA256确保数据未被篡改
3. **时间戳验证**: 5分钟窗口防止重放攻击
4. **随机IV**: 每个数据包使用唯一初始化向量
5. **密钥安全**: 安全的密钥派生和管理

## ⚙️ 配置选项

编辑 `src/config.js` 以自定义配置：

```javascript
const config = {
  server: {
    host: '0.0.0.0',        // 服务端监听地址
    port: 8388,             // 服务端端口
    password: 'your-key',   // 代理密码
    timeout: 30000          // 连接超时(ms)
  },
  client: {
    localHost: '127.0.0.1', // 本地监听地址
    localPort: 1088,        // 本地端口
    serverHost: 'server-ip', // 服务端地址
    serverPort: 8388,       // 服务端端口
    password: 'your-key'    // 代理密码
  }
};
```

## 📊 性能特点

- **低延迟**: 优化的数据包处理流程
- **高并发**: 异步I/O和连接池管理
- **内存高效**: 流式数据处理，避免大缓冲区
- **错误恢复**: 自动重连和故障转移

## 🔍 监控和日志

服务自动记录：
- 连接统计信息
- 数据传输量
- 错误和异常
- 性能指标

## 🚨 注意事项

1. **仅用于学习**: 这是一个教学项目，不建议在生产环境使用
2. **加密强度**: 实际应用应使用AES等标准加密算法
3. **网络环境**: 确保防火墙允许相应端口通信
4. **密码安全**: 使用强密码并定期更换

## 🤝 贡献

欢迎提交Issue和Pull Request来改进项目！

## 📄 许可证

MIT License - 详见 LICENSE 文件